local weaponinfo={}
 
weaponinfo.default = {
    tfcss_galil_alt = {
        Model="models/weapons/3_rif_galil.mdl",
        Bone="ValveBiped.Bip01_Spine",
        BoneOffset={Vector(3.5,7,-9),Angle(0,25,-30)}
    },
	tfcss_ak47_alt = {
        Model="models/weapons/3_rif_ak47.mdl",
        Bone="ValveBiped.Bip01_Spine",
        BoneOffset={Vector(3.5,7,-9),Angle(0,25,-30)}
    },
	tfcss_sg552_alt = {
        Model="models/weapons/3_snip_sg552.mdl",
        Bone="ValveBiped.Bip01_Spine",
        BoneOffset={Vector(3.5,7,-9),Angle(0,25,-30)}
    },
	tfcss_m4a1_alt = {
        Model="models/weapons/3_rif_m4a1.mdl",
        Bone="ValveBiped.Bip01_Spine",
        BoneOffset={Vector(3.5,7,-9),Angle(0,25,-30)}
    },
	tfcss_famas_alt = {
        Model="models/weapons/3_rif_famas.mdl",
        Bone="ValveBiped.Bip01_Spine",
        BoneOffset={Vector(3.5,7,-9),Angle(0,25,-30)}
    },
    tfcss_aug_alt = {
        Model="models/weapons/3_rif_aug.mdl",
        Bone="ValveBiped.Bip01_Spine",
        BoneOffset={Vector(3.5,11,-10),Angle(0,25,-30)}
    },
    tfcss_mac10_alt = {
        Model="models/weapons/3_smg_mac10.mdl",
        Bone="ValveBiped.Bip01_Spine1",
        BoneOffset={Vector(-7+4,1+2,5+1),Angle(90,0-10,0)}
    },
    tfcss_p90_alt = {
        Model="models/weapons/3_smg_p90.mdl",
        Bone="ValveBiped.Bip01_Spine1",
        BoneOffset={Vector(-7+4,1+2,5+1),Angle(90,0-10,0)}
    },
    tfcss_ump45_alt = {
        Model="models/weapons/3_smg_ump45.mdl",
        Bone="ValveBiped.Bip01_Spine1",
        BoneOffset={Vector(-7+4,1+2,5+1),Angle(90,0-10,0)}
    },
    tfcss_tmp_alt = {
        Model="models/weapons/3_smg_tmp.mdl",
        Bone="ValveBiped.Bip01_Spine1",
        BoneOffset={Vector(-7+4,1+2,5+1),Angle(90,0-10,0)}
    },
	tfcss_mp5_alt = {
        Model="models/weapons/3_smg_mp5.mdl",
        Bone="ValveBiped.Bip01_Spine1",
        BoneOffset={Vector(-7+4,1+2,5+1),Angle(90,0-10,0)}
    },
    tfcss_m3_alt = {
        Model="models/weapons/3_shot_m3super90.mdl",
        Bone="ValveBiped.Bip01_Spine1",
        BoneOffset={Vector(3.5,7,-9+4),Angle(0,25-15,-30)}
    },
    tfcss_xm1014_alt = {
        Model="models/weapons/3_shot_xm1014.mdl",
        Bone="ValveBiped.Bip01_Spine1",
        BoneOffset={Vector(3.5,7,-9+4),Angle(0,25-15,-30)}
    },
    tfcss_m249_alt = {
        Model="models/weapons/3_mach_m249para.mdl",
        Bone="ValveBiped.Bip01_R_Clavicle",
        BoneOffset={Vector(10+9,5,-5+4),Angle(0,100,27-12)}
    },
    tfcss_scout_alt = {
        Model="models/weapons/3_snip_scout.mdl",
        Bone="ValveBiped.Bip01_R_Clavicle",
        BoneOffset={Vector(10,5,-5),Angle(0,100,27)}
    },
    tfcss_sg550_alt = {
        Model="models/weapons/3_snip_sg550.mdl",
        Bone="ValveBiped.Bip01_R_Clavicle",
        BoneOffset={Vector(10,5,-5),Angle(0,100,27)}
    },
    tfcss_awp_alt = {
        Model="models/weapons/3_snip_awp.mdl",
        Bone="ValveBiped.Bip01_R_Clavicle",
        BoneOffset={Vector(10,5,-5),Angle(0,100,27)}
    },
    tfcss_g3sg1_alt = {
        Model="models/weapons/3_snip_g3sg1.mdl",
        Bone="ValveBiped.Bip01_R_Clavicle",
        BoneOffset={Vector(10,5,-5),Angle(0,100,27)}
    },
    tfcss_usp_alt = {
        Model="models/weapons/3_pist_usp.mdl",
        Bone="ValveBiped.Bip01_R_Thigh",
        BoneOffset={Vector(-4,5,-4.5),Angle(90,0,0)}
    },
    tfcss_fiveseven_alt = {
        Model="models/weapons/3_pist_fiveseven.mdl",
        Bone="ValveBiped.Bip01_R_Thigh",
        BoneOffset={Vector(-4,5,-4.5),Angle(90,0,0)}
    },
    tfcss_p228_alt = {
        Model="models/weapons/3_pist_p228.mdl",
        Bone="ValveBiped.Bip01_R_Thigh",
        BoneOffset={Vector(-4,5,-4.5),Angle(90,0,0)}
    },
    tfcss_glock_alt = {
        Model="models/weapons/3_pist_glock.mdl",
        Bone="ValveBiped.Bip01_R_Thigh",
        BoneOffset={Vector(-4,5,-4.5),Angle(90,0,0)}
    },
	 tfcss_deagle_alt = {
        Model="models/weapons/3_pist_deagle.mdl",
        Bone="ValveBiped.Bip01_R_Thigh",
        BoneOffset={Vector(-4,5,-4.5),Angle(90,0,0)}
    },
    tfcss_dualelites_alt = {
        Model="models/weapons/3_pist_elite.mdl",
        Bone="ValveBiped.Bip01_R_Thigh",
        BoneOffset={Vector(0,8,-4.5),Angle(0,0,0)}
    },
    weapon_hegrenade = {
        Model="models/weapons/w_m61_fraggynade_thrown.mdl",
        Bone="ValveBiped.Bip01_L_Thigh",
        BoneOffset={Vector(2,6,5),Angle(90,0,90)}
    },
    weapon_c4 = {
        Model="models/weapons/w_c4.mdl",
        Bone="ValveBiped.Bip01_R_Thigh",
        BoneOffset={Vector(2,6,5+1),Angle(90,0+100,90-90)}
    },
	
    -- HL2
    weapon_pistol = {
        Model="models/weapons/W_pistol.mdl",
        Bone="ValveBiped.Bip01_Pelvis",
        BoneOffset={Vector(0,-8,0),Angle(0,90,0)}
    },
    weapon_357 = {
        Model="models/weapons/W_357.mdl",
        Bone="ValveBiped.Bip01_Pelvis",
        BoneOffset={Vector(-5,8,0),Angle(0,270,0)}
    },
    weapon_frag = {
        Model="models/Items/grenadeAmmo.mdl",
        Bone="ValveBiped.Bip01_Pelvis",
        BoneOffset={Vector(3,-5,6),Angle(-95,0,0)}
    },
    weapon_slam = {
        Model="models/weapons/w_slam.mdl",
        Bone="ValveBiped.Bip01_Spine2",
        BoneOffset={Vector(-9,0,-7),Angle(270,90,-25)}
    },
    weapon_crowbar = {
        Model="models/weapons/w_crowbar.mdl",
        Bone="ValveBiped.Bip01_Spine1",
        BoneOffset={Vector(3,0,0),Angle(0,0,45)}
    },
    weapon_stunstick = {
        Model="models/weapons/W_stunbaton.mdl",
        Bone="ValveBiped.Bip01_Spine1",
        BoneOffset={Vector(3,0,0),Angle(0,0,-45)}
    },
    weapon_shotgun = {
        Model="models/weapons/W_shotgun.mdl",
        Bone="ValveBiped.Bip01_R_Clavicle",
        BoneOffset={Vector(10,5,2),Angle(0,90,0)}
    },
    weapon_rpg = {
        Model="models/weapons/w_rocket_launcher.mdl",
        Bone="ValveBiped.Bip01_L_Clavicle",
        BoneOffset={Vector(-16,5,0),Angle(90,90,90)}
    },
    weapon_smg1 = {
        Model="models/weapons/w_smg1.mdl",
        Bone="ValveBiped.Bip01_Spine1",
        BoneOffset={Vector(5,0,-5),Angle(0,0,230)}
    },
    weapon_ar2 = {
        Model="models/weapons/W_irifle.mdl",
        Bone="ValveBiped.Bip01_R_Clavicle",
        BoneOffset={Vector(-5,0,7),Angle(0,270,0)}
    },
    weapon_crossbow = {
        Model="models/weapons/W_crossbow.mdl",
        Bone="ValveBiped.Bip01_L_Clavicle",
        BoneOffset={Vector(0,5,-5),Angle(180,90,0)}
    }
}
 
//guard models
temp = {
    tfcss_m4a1_alt = {Vector(10-7.2,11+3,-8+3),Angle(0,40,-33)},
    tfcss_ak47_alt = {Vector(10-9.2,11+4,-8+3),Angle(0,40,-33)},
    tfcss_famas_alt = {Vector(10-5.2,11+1,-8),Angle(0,40,-33)},
    tfcss_m3_alt = {Vector(10-4.5,11+1,-9+4),Angle(0,40-25,-33)},
    tfcss_scout_alt = {Vector(10-1,5+1,-5+8.8),Angle(0,100,20)},
    tfcss_mp5_alt = {Vector(-7+8,10,5),Angle(90,0,0)},
    tfcss_deagle_alt = {Vector(-4+2,5+1,-4.5),Angle(-90,0,180)},
    tfcss_usp_alt = {Vector(-4+3,5+1,-4.5),Angle(-90,0,180)},
    tfcss_fiveseven_alt = {Vector(-4+5,5+1,-4.5),Angle(90,0,0)},
    tfcss_p228_alt = {Vector(-4,5+1,-4.5),Angle(90,0,0)},
   
   /*
    weapon_galil = {Vector(10-5.2,11+1,-8),Angle(0,40,-33)},
    weapon_aug = {Vector(9.5-6,15-3,-9),Angle(0,25+20,-55)},
    weapon_mac10 = {Vector(-7+5,10-2,5),Angle(90,0,0)},
    weapon_tmp = {Vector(-7+5,10-2,5),Angle(90,0,0)},
    weapon_p90 = {Vector(-7+5,10-2,5),Angle(90,0,0)},
    weapon_scout = {Vector(10-1,5+1,-5+3),Angle(0,120,15)},
    weapon_awp = {Vector(10-1,5+1,-5+3),Angle(0,120,15)},
    weapon_usp = {Vector(-4-1,5+1,-4.5),Angle(90,0,0)},
    weapon_fiveseven = {Vector(-4-1,5+1,-4.5),Angle(90,0,0)},
    weapon_p228 = {Vector(-4-1,5+1,-4.5),Angle(90,0,0)},
    weapon_dualelites = {Vector(-4+5,5+1.5,-4.5-1),Angle(0,0,0)},
    weapon_m3 = {Vector(10-4.5,11-3,-9+4),Angle(0,40-25,-33)},
    weapon_xm1014 = {Vector(10-4.5,11-3,-9+4),Angle(0,40-25,-33)},
    weapon_m249 = {Vector(10+7,5+0.5,-5+7),Angle(0,120,15)},
    weapon_hegrenade = {Vector(2+2.5,6,5-9.5),Angle(90,0,90)},
    --weapon_smoke = {Vector(2-8,6-1,5-9.5),Angle(90,0,90)},
    weapon_c4 = {Vector(2-4,6+2,5+1),Angle(90,0+100,90-90)},
    --weapon_knife = {Vector(2-5,6-4,5+1),Angle(45,12,-85)},
    weapon_tcrowbar = {Vector(2-9,6-25,5+5),Angle(120,2,-160)}
	*/
}
weaponinfo["models/player/combine_soldier.mdl"] = table.Copy(weaponinfo.default)
for k,v in pairs(temp) do
    weaponinfo["models/player/combine_soldier.mdl"][k].BoneOffset = v
end

weaponinfo["models/player/combine_soldier_prisonguard.mdl"] = weaponinfo["models/player/combine_soldier.mdl"]
weaponinfo["models/player/combine_super_soldier.mdl"] = weaponinfo["models/player/combine_soldier.mdl"]
 
function CalcOffset(pos,ang,off)
    return pos + ang:Right() * off.x + ang:Forward() * off.y + ang:Up() * off.z
end
 
 
local holsteredgunsconvar = CreateConVar( "cl_holsteredguns", "1", { FCVAR_ARCHIVE, }, "Enable/Disable the rendering of the weapons on any player" )
local NEXT_UPDATE = 0
hook.Add("Think","Holster_Think",function()
    if not holsteredgunsconvar:GetBool() or NEXT_UPDATE > CurTime() then return end
    NEXT_UPDATE = CurTime() + 600 
    for _,pl in pairs(player.GetAll()) do
        if !IsValid(pl) then continue end
 
        if pl.CL_WEPS then
            for k,v in pairs(pl.CL_WEPS) do
                if not pl:HasWeapon(k) or not pl:Alive() then
                    v:Remove()
                    pl.CL_WEPS[k]=nil
                end
            end
        else
            pl.CL_WEPS={}
        end
        for i,v in pairs(pl:GetWeapons())do
            if !IsValid(v) or pl.CL_WEPS[v:GetClass()] or (v.Slot==1 or v.Slot==2 or v.Slot==3) then continue end
            local worldmodel
            local modeltable = weaponinfo[pl:GetModel()]
            local weapontable = modeltable and modeltable[v:GetClass()] or weaponinfo.default[v:GetClass()]
            if weapontable && weapontable.Model then
                worldmodel=weapontable.Model
            end
           
            if !worldmodel || worldmodel=="" then continue end
           
            pl.CL_WEPS[v:GetClass()]=ClientsideModel(worldmodel,RENDERGROUP_OPAQUE)
            pl.CL_WEPS[v:GetClass()]:SetNoDraw(true)
            pl.CL_WEPS[v:GetClass()]:SetSkin(v:GetSkin())
            pl.CL_WEPS[v:GetClass()]:SetColor(v:GetColor())
        end
    end
    NEXT_UPDATE = CurTime() + 3
end)
 
hook.Add("PostPlayerDraw","Holster_Draw",function(pl)
    if !holsteredgunsconvar:GetBool() or !IsValid(pl) or !pl.CL_WEPS then return end
    for i,v in pairs(pl.CL_WEPS) do
        local modeltable = weaponinfo[pl:GetModel()]
        local weapontable = modeltable and modeltable[i] or weaponinfo.default[i]
        if weapontable and pl:HasWeapon(i) and (pl:GetActiveWeapon()==NULL || pl:GetActiveWeapon():GetClass()~=i) then
            local bone = pl:LookupBone(weapontable.Bone or "")
            if !bone then continue end
           
            local matrix = pl:GetBoneMatrix(bone)
            if !matrix then continue end
           
            local pos = matrix:GetTranslation()
            local ang = matrix:GetAngles()
            local pos = CalcOffset(pos,ang,weapontable.BoneOffset[1])
           
            v:SetRenderOrigin(pos)
           
            ang:RotateAroundAxis(ang:Forward(),weapontable.BoneOffset[2].p)
            ang:RotateAroundAxis(ang:Up(),weapontable.BoneOffset[2].y)
            ang:RotateAroundAxis(ang:Right(),weapontable.BoneOffset[2].r)
            v:SetRenderAngles(ang)
            v:DrawModel()
        end
    end
end)